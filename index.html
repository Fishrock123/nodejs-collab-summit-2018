<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
  <title>Big</title>
  <link href='big.css' rel='stylesheet' type='text/css' />
  <link href='highlight.css' rel='stylesheet' type='text/css' />
  <style>
    .new-shiny { background: #aaaaaa; }
  </style>
  <script src='big.js'></script>
  <script src='highlight.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body class='light'>
  <div>Node Collab Summit Vancouver 2018</div>
  <div>- the <del>streams</del> BOB edition</div>
  <div>
    A different<br><em>Project Approach</em>
  </div>
  <div>
    Not immediately necessary
  </div>
  <div>
    We can take the time to get it right
  </div>
  <div>
    1. <em>Why</em><br>
    2. <em>Goals</em><br>
    3. <em>Api</em><br>
    4. <em>Current Modules</em><br>
    5. <em>Performance</em>
  </div>
  <div>
    1. <em>Why</em> reinvent streams?
  </div>
  <div>
    The Streams <em>user experiance</em> is bad
  </div>
  <div>
    Streams <em>performance</em> is underwhelming
  </div>
  <div>
    2. <em>Goals</em>
  </div>
  <div>
    <ul>
      <li><em>Performance</em> and <em>ease-of-use</em> are key.</li>
      <li>Implementable in a performant and usable way for both <em>JS and C++</em>.</li>
      <li>Browser portability is preferable.</li>
    </ul>
  </div>
  <div>
    Protocol <em>Goals</em>
  </div>
  <div>
    <ul>
      <li>Pull-based</li>
      <li>Binary-only</li>
      <li>Stateless (in-protocol)</li>
      <li>One-to-one (no events)</li>
      <li>Timing agnostic</li>
      <li>No buffering (in-protocol)</li>
      <li>In-line errors and "end"</li>
    </ul>
  </div>
  <div>
    Consumer <em>Goals</em>
  </div>
  <div>
    <ul>
      <li>Should own any preallocated memory (the buffer).</li>
      <li>Must never make more than one data request upstream at the same time.</li>
    </ul>
  </div>
  <div>
    The <em>Current Proposed API</em>
  </div>
  <div>
    Some terms:
    <ul>
      <li><em>Consumer</em> / "<em>Sink</em>" - API end where data goes to.</li>
      <li><em>Producer</em> / "<em>Source</em>" - API end where data comes from.</li>
    </ul>
  </div>
  <div>
    <small>Sink API</small>
    <br>
    <pre>
class Sink {
  constructor (opts) {}

  bindSource (source, bindCb) {
    this.source = source

  }

  next (status, error, buffer, bytes) {
    // do stuff with received data

  }
}
    </pre>
  </div>
  <div>
    <small>Sink API</small>
    <br>
    <pre>
class Sink {
  constructor (opts) {}

  bindSource (source, bindCb) {
    this.source = source
    this.source.bindSink(this)
  }

  next (status, error, buffer, bytes) {
    // do stuff with received data
    this.source.pull(null, buffer)
  }
}
    </pre>
  </div>
  <div>
    <small>Source API</small>
    <br>
    <pre>
class Source {
  constructor (opts) {}

  bindSink (sink) {
    this.sink = sink
  }

  pull (error, buffer) {
    // get data


  }
}
    </pre>
  </div>
  <div>
    <small>Source API</small>
    <br>
    <pre>
class Source {
  constructor (opts) {}

  bindSink (sink) {
    this.sink = sink
  }

  pull (error, buffer) {
    // get data
    this.sink.next(status_type.continue, null,
                   buffer, bytesWritten)
  }
}
    </pre>
  </div>
  <div>
    <pre>
class PassThrough {
  bindSource (source) {
    source.bindSink(this)
    this.source = source
    return this
  }

  bindSink (sink) {
    this.sink = sink
  }

  next (status, error, buffer, bytes) {
    this.sink.next(status, error, buffer, bytes)
  }

  pull (error, buffer) {
    this.source.pull(error, buffer)
  }
}
    </pre>
  </div>
  <div>
    Composing a source & sink
    <br>
    <pre>
const source = new Source(opts)
const sink = new Sink(opts)

sink.bindSource(source, error => {
  // The stream is finished when this is called.
})
    </pre>
  </div>
  <div>
    <img src="diagrams/BOB-diagram.png" />
  </div>
  <div>
    <img src="diagrams/BOB-errors-diagram.png" />
  </div>
  <div>
    Current <em>Modules</em>
  </div>
  <div>
    <ul>
      <li>bob-status</li>
      <li>fs-source</li>
      <li>fs-sink</li>
      <li>zlib-transform</li>
      <li>github.com/Fishrock123/socket</li>
    </ul>
  </div>
  <div>
    Current API <em>Performance</em>
  </div>
  <div>
    For a single long stream
    <ul>
      <li>30% decrease of CPU time in bad cases</li>
      <li><em>Up to 8x decrease</em> in good cases</li>
      <li>Should correlate to overall throughput but may not be exact.</li>
    </ul>
  </div>
  <div>
    <em>\o/</em>
  </div>
  <div>
    github.com/Fishrock123/bob
  </div>
</body>
</html>
